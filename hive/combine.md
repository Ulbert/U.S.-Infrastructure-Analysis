# Instructions for merging data on hive

Make sure in the directory input, tax.csv, transportation.csv, and water_quality.csv are in same directory. The results of these files are generated by the other code. 

1. Put files on hdfs 

***Note***: In /input, there is a bash file that can do input files for hdfs. From step 2, it has to be manually placed in. Do this in your own local directory. Doesn't matter where this is placed

- Delete directories (if applicable)
hdfs dfs -rm -r tax
hdfs dfs -rm -r transport
hdfs dfs -rm -r water

- Make a directory for each input file
hdfs dfs -mkdir tax
hdfs dfs -mkdir transport
hdfs dfs -mkdir water

cd input

hdfs dfs -put tax tax
hdfs dfs -put transportation transport
hdfs dfs -put water_quality water

2. Go onto hive

beeline
!connect jdbc:hive2://babar.es.its.nyu.edu:10000/
use (Your Net ID);

3. Create tables

**IMPORTANT**: Remember to substitute your net id when creating the table

- Create transport table

create external table transport(state string, county string, bridges int, residents int, pctMediumToFairBridges double, pctPoorBridges double, milesFreightRailroad double, roadsAcceptable double, countyArea double) row format delimited fields terminated by ',' location '/user/(your net id)/transport';

- Create Tax table

create external table tax(state string, county string,taxRespondents double,stateLocalIncomeTax double, realEstateTax double) row format delimited fields terminated by ',' location '/user/(your net id)/tax';

- Create Water Quality table

create external table water(state string, county string, populationServed int, waterSystems int) row format delimited fields terminated by ',' location '/user/(your net id)/water';

- At this point there should be three tables

4. Combine Tables

- Combine tax and transport tables to create taxtransport

create table taxtransport as select transport.*, tax.taxRespondents, tax.stateLocalIncomeTax, tax.realEstateTax from transport join tax on (transport.state = tax.state and transport.county = tax.county);

- Combine taxtransport and water tables to create final

create table combined as select taxtransport.*, water.populationserved, water.watersystems from taxtransport join water on (taxtransport.state = water.state and taxtransport.county = water.county);

5. Go to analytic(./analytic.md) to do analytics on the combined table